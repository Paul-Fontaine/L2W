<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>L2W - ZERO DÉCHETS EN RADE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="first.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

  <!-- Header -->
  <header>
            <h1><a href="index.html" style="color: inherit; text-decoration: none;">L2W</a></h1>
            <nav>
                <a href="index.html">Accueil</a>
                <a href="form.html">Créer</a>
                <a href="liste_collecte.html">Rejoindre</a>
                <a href="connexion.html">Se connecter</a>
            </nav>
        </header>

  <!-- Hero -->
  <section class="hero" data-aos="fade-up">
    <div>
      <h2>ZERO DÉCHETS EN RADE</h2>
      <p>Rejoignez la communauté de bénévoles engagés pour protéger le littoral de la rade de Brest. Organisez et participez aux actions de ramassage des déchets.</p>
      <a class="btn" href="#about">Découvrir la communauté</a>
    </div>
  </section>

  <!-- Stats -->
  <section class="stats">
    <div class="stat-box" data-aos="zoom-in">
      <h3 id="kg-dechets">0</h3>
      <p>Kg de déchets ramassés</p>
    </div>
    <div class="stat-box" data-aos="zoom-in">
      <h3 id="nb-inscrits">0</h3>
      <p>Nombre de bénévoles inscrits</p>
    </div>
    <div class="stat-box" data-aos="zoom-in">
      <h3 id="nb-events">0</h3>
      <p>Évènements organisés</p>
    </div>
  </section>

  <!-- À propos de nous -->
  <section class="about" id="about">
    <div class="about-container">
      <h2>À propos de nous</h2>
      <div class="about-content">
        <div class="about-text">
          <p>
            <strong>L2W (Lastez war wel)</strong> est une association environnementale locale engagée 
            pour la protection du littoral de la rade de Brest. Notre mission est de réduire la 
            pollution et d'offrir aux habitants un environnement plus agréable en bord de mer.
          </p>
          <p>
            Nous encourageons et structurons les initiatives de ramassage des déchets sur l'ensemble 
            du littoral, de Plouzané à Plougastel-Daoulas. Grâce à notre plateforme numérique, nous 
            fédérons une communauté de bénévoles engagés et facilitons l'organisation de ces actions 
            sur le territoire.
          </p>
          <p>
            Rejoignez-nous pour protéger ensemble notre magnifique littoral breton !
          </p>
        </div>
        <div class="about-images">
          <img src="images/drap_breton.png" alt="Drapeau breton" class="about-img">
          <img src="images/dechets.png" alt="Déchets et bouteilles" class="about-img">
        </div>
      </div>
    </div>
  </section>

  <!-- Actions -->
  <section class="actions" id="actions">
    <h2>Agir maintenant</h2>
    <div class="action-grid">
      <div class="action-card">
        <h3>Créer un évènement</h3>
        <p>
          Propose une collecte (lieu, date, heure) pour mobiliser des bénévoles sur le littoral
          de la rade de Brest.
        </p>
        <a class="btn" href="form.html">Créer un évènement</a>
      </div>

      <div class="action-card">
        <h3>Rejoindre un évènement</h3>
        <p>
          Découvre les collectes près de chez toi et inscris-toi pour participer à une action
          de ramassage.
        </p>
        <a class="btn" href="liste_collecte.html">Rejoindre un évènement</a>
      </div>
    </div>
  </section>

  <!-- Où jeter les déchets -->
  <section class="waste-map">
    <div class="waste-map-container">
      <h2>Où jeter vos déchets dans la rade de Brest</h2>
      <p class="waste-map-intro">
        Trouvez les points de collecte et de tri près de chez vous pour jeter vos déchets 
        de manière responsable dans Brest et ses alentours.
      </p>
      <div id="map"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>© 2026 L2W. All Rights Reserved.</p>
  </footer>

  <link rel="stylesheet" href="first.css">

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Script permettant au bouton "découvrir la communautée" de défiler plus lentement-->
  <script>
    // Scroll plus lent vers les ancres (ex: bouton "Découvrir la communauté")
    document.querySelectorAll('a[href^="#"]').forEach(link => {
      link.addEventListener('click', function(e) {
        const targetId = this.getAttribute('href');
        const targetEl = document.querySelector(targetId);
        if (!targetEl) return;
        e.preventDefault();
        const duration = 900; // durée en ms (plus grand = plus lent)
        const start = window.pageYOffset;
        const end = targetEl.getBoundingClientRect().top + window.pageYOffset;
        const distance = end - start;
        let startTime = null;

        const easeInOutQuad = (t) => t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;

        const animate = (currentTime) => {
          if (!startTime) startTime = currentTime;
          const timeElapsed = currentTime - startTime;
          const progress = Math.min(timeElapsed / duration, 1);
          const ease = easeInOutQuad(progress);
          window.scrollTo(0, start + distance * ease);
          if (timeElapsed < duration) requestAnimationFrame(animate);
        };

        requestAnimationFrame(animate);
      });
    });
  </script>

  <!-- Script pour la carte Leaflet -->
  <script>
    // Initialisation de la carte centrée sur Brest
    const map = L.map('map').setView([48.3904, -4.4861], 12);

    // Ajout de la couche de tuiles OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    // Points de collecte dans Brest et alentours
    const pointsCollecte = [
      {
        name: 'Déchetterie de Brest - Kervallon',
        lat: 48.3980,
        lng: -4.4850,
        type: 'Déchetterie',
        address: 'Route de Kervallon, 29200 Brest'
      },
      {
        name: 'Déchetterie de Brest - Kéranroux',
        lat: 48.4200,
        lng: -4.5000,
        type: 'Déchetterie',
        address: 'Rue de Kéranroux, 29200 Brest'
      },
      {
        name: 'Point de tri - Centre-ville Brest',
        lat: 48.3904,
        lng: -4.4861,
        type: 'Point de tri',
        address: 'Place de la Liberté, 29200 Brest'
      },
      {
        name: 'Déchetterie de Plouzané',
        lat: 48.3833,
        lng: -4.6167,
        type: 'Déchetterie',
        address: 'Plouzané, 29280'
      },
      {
        name: 'Déchetterie de Plougastel-Daoulas',
        lat: 48.3667,
        lng: -4.3667,
        type: 'Déchetterie',
        address: 'Plougastel-Daoulas, 29470'
      },
      {
        name: 'Point de collecte - Le Relecq-Kerhuon',
        lat: 48.4000,
        lng: -4.4000,
        type: 'Point de tri',
        address: 'Le Relecq-Kerhuon, 29480'
      }
    ];

    // Icônes personnalisées
    const iconDechetterie = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const iconPointTri = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    // Ajout des marqueurs sur la carte
    pointsCollecte.forEach(point => {
      const icon = point.type === 'Déchetterie' ? iconDechetterie : iconPointTri;
      const marker = L.marker([point.lat, point.lng], { icon: icon }).addTo(map);
      marker.bindPopup(`
        <strong>${point.name}</strong><br>
        <em>${point.type}</em><br>
        ${point.address}
      `);
    });
  </script>

  <!-- Script pour les statistiques -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Charger les données : fusionner events.json avec localStorage
      fetch("events.json")
        .then(response => response.json())
        .then(jsonData => {
          // Charger localStorage s'il existe
          let mergedData = { events: { ...jsonData.events } };
          
          try {
            const storedData = localStorage.getItem("eventsData");
            if (storedData) {
              const parsedStored = JSON.parse(storedData);
              if (parsedStored && parsedStored.events) {
                // Fusionner : events.json en base, localStorage en complément
                mergedData.events = { ...jsonData.events, ...parsedStored.events };
              }
            }
          } catch (e) {
            console.warn("Erreur lors du chargement de localStorage, utilisation de events.json uniquement", e);
          }

          const events = mergedData.events || {};

          // Calculer les statistiques
          let totalDechets = 0;
          let totalBenevoles = 0;
          let nombreEvents = Object.keys(events).length;

          // Parcourir tous les événements
          Object.values(events).forEach(event => {
            // Calculer le total de déchets (depuis les résultats)
            if (event.resultat && event.resultat.dechet_total_kg) {
              totalDechets += parseFloat(event.resultat.dechet_total_kg) || 0;
            }

            // Calculer le nombre total de bénévoles inscrits
            if (event.participants) {
              Object.values(event.participants).forEach(participant => {
                // Gérer les deux formats : objet {nombre} ou string
                let nombre;
                if (typeof participant === 'object' && participant !== null) {
                  nombre = parseInt(participant.nombre || participant.nombre_participants || "0", 10);
                } else {
                  nombre = parseInt(participant || "0", 10);
                }
                totalBenevoles += isNaN(nombre) ? 0 : nombre;
              });
            }
          });

          // Fonction pour animer le comptage
          function animateValue(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const range = end - start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            let current = start;
            const timer = setInterval(() => {
              current += increment;
              if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                current = end;
                clearInterval(timer);
              }
              
              // Formater les nombres
              if (elementId === 'kg-dechets') {
                element.textContent = Math.round(current);
              } else {
                element.textContent = Math.round(current);
              }
            }, stepTime);
          }

          // Animer les statistiques
          setTimeout(() => {
            animateValue('kg-dechets', 0, totalDechets, 2000);
            animateValue('nb-inscrits', 0, totalBenevoles, 2000);
            animateValue('nb-events', 0, nombreEvents, 1500);
          }, 500);
        })
        .catch(error => {
          console.error("Erreur lors du chargement des statistiques:", error);
        });
    });
  </script>
</body>
</html>
 