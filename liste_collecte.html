<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="UTF-8">
        <title>Liste des collectes</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="first.css" rel="stylesheet">
        <link href="liste_collecte.css" rel="stylesheet">
    </head>
    <body>
        <header>
            <h1><a href="index.html" style="color: inherit; text-decoration: none;">L2W</a></h1>
            <nav>
                <a href="index.html">Accueil</a>
                <a href="form.html">CrÃ©er</a>
                <a href="liste_collecte.html">Rejoindre</a>
                <a href="#">Se connecter</a>
            </nav>
        </header>

        <main class="collectes-container">
            <div id="collectesContent">
                <p>Chargement des collectes...</p>
            </div>
        </main>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const container = document.getElementById("collectesContent");

                // Charger depuis localStorage si existe, sinon depuis le fichier JSON
                const storedData = localStorage.getItem("eventsData");
                let dataPromise;

                if (storedData) {
                    dataPromise = Promise.resolve(JSON.parse(storedData));
                } else {
                    dataPromise = fetch("events.json")
                        .then(response => response.json());
                }

                dataPromise
                    .then(data => {
                        const events = data.events || {};

                        if (Object.keys(events).length === 0) {
                            container.innerHTML = `
                                <div class="no-collectes">
                                    <h2>Aucune collecte disponible</h2>
                                    <p>Il n'y a pas encore d'Ã©vÃ©nements de ramassage organisÃ©s.</p>
                                    <p>CrÃ©ez-en un dÃ¨s maintenant !</p>
                                </div>
                            `;
                            return;
                        }

                        const html = `
                            <h2>Liste des collectes</h2>
                            <ul class="collecte-list">
                                ${Object.entries(events).map(([eventName, eventDetails]) => {
                                    const lieu = eventDetails.lieu || "Lieu non spÃ©cifiÃ©";
                                    const organisateur = eventDetails.organisateur || "Organisateur non spÃ©cifiÃ©";
                                    const date = eventDetails.date_debut || eventDetails.date || "Date non spÃ©cifiÃ©e";
                                    const adresse = eventDetails.adresse || "";
                                    const participantsCount = eventDetails.participants ? Object.keys(eventDetails.participants).length : 0;

                                    return `
                                    <li>
                                        <a href="info_collecte.html?collecte=${encodeURIComponent(eventName)}" class="collecte-card">
                                            <span class="collecte-title">${eventName}</span>
                                            <div class="collecte-info-item">
                                                <strong>ğŸ“ Lieu :</strong>
                                                <span>${lieu}${adresse ? ` - ${adresse}` : ''}</span>
                                            </div>
                                            <div class="collecte-info-item">
                                                <strong>ğŸ‘¤ Organisateur :</strong>
                                                <span>${organisateur}</span>
                                            </div>
                                            <div class="collecte-info-item">
                                                <strong>ğŸ“… Date :</strong>
                                                <span>${date_debut}</span>
                                            </div>
                                            ${participantsCount > 0 ? `
                                            <div class="collecte-info-item">
                                                <strong>ğŸ‘¥ Participants :</strong>
                                                <span>${participantsCount} personne${participantsCount > 1 ? 's' : ''}</span>
                                            </div>
                                            ` : ''}
                                            <span class="collecte-badge">Voir les dÃ©tails â†’</span>
                                        </a>
                                    </li>
                                    `;
                                }).join("")}
                            </ul>
                        `;
                        container.innerHTML = html;
                    })
                    .catch(error => {
                        console.error("Erreur lors du chargement du JSON:", error);
                        container.innerHTML = `
                            <div class="no-collectes">
                                <h2>Erreur de chargement</h2>
                                <p>Impossible de charger les collectes. Veuillez rÃ©essayer plus tard.</p>
                            </div>
                        `;
                    });
            });
        </script>

    </body>
</html>